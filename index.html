<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lolipop</title>
    <script src="https://d3js.org/d3.v6.js"></script>
    <style>
      .tooltip {
  position: absolute;
  pointer-events: none;
  background-color: rgb(202, 202, 202);
  border: 1px solid gray;
  color: rgb(0, 0, 0);
  padding: 8px;
}

    </style>
</head>
<body>
    <div class="container">
        <button onclick="update('var1')">Variable 1</button>
        <button onclick="update('var2')">Variable 2</button>
        <div id="my_dataviz"></div>
    </div>
   
    
    <script>

        const margin = {top: 300, right: 300, bottom: 70, left: 560},
            width = 2000 - margin.left - margin.right,
            height = 900 - margin.top - margin.bottom;
        
        const svg = d3.select("#my_dataviz")
          .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("transform", `translate(${margin.left}, ${margin.top})`);
        
        const x = d3.scaleBand()
          .range([ -10, width ])
          .padding(1);
        const xAxis = svg.append("g")
          .attr("transform", `translate(0, ${height})`)
        
        const y = d3.scaleLinear()
          .range([ height, 0]);
        const yAxis = svg.append("g")
          .attr("class", "myYaxis")
        
        
        function update(selectedVar) {
        
          d3.csv("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/barplot_change_data.csv").then( function(data) {
        
            x.domain(data.map(function(d) { return d.group; }))
            xAxis.transition().duration(1000).call(d3.axisBottom(x))
        
            y.domain([0, d3.max(data, function(d) { return +d[selectedVar] }) ]);
            yAxis.transition().duration(1000).call(d3.axisLeft(y));
        
            const j = svg.selectAll(".myLine")
              .data(data)
            j
              .join("line")
              .attr("class", "myLine")
              .transition()
              .duration(1000)
                .attr("x1", function(d) { return x(d.group); })
                .attr("x2", function(d) { return x(d.group); })
                .attr("y1", y(0))
                .attr("y2", function(d) { return y(d[selectedVar]); })
                .attr("stroke", "blue")
                .attr("stroke-width", 2)
        
        
            const u = svg.selectAll("circle")
              .data(data)
            u
              .join("circle")
              .transition()
              .duration(1000)
                .attr("cx", function(d) { return x(d.group); })
                .attr("cy", function(d) { return y(d[selectedVar]); })
                .attr("r", 8)
                .attr("fill", "#69b3a2");

const tooltip = d3.select("body")
  .append("div")
  .attr("class", "tooltip")
  .style("opacity", 0);


const circles = svg.selectAll("circle");
circles
  .on("mouseover", handleMouseOver)
  .on("mouseout", handleMouseOut)
  .on("click", handleClick);

function handleMouseOver(event, d) {
  d3.select(this)
    .attr("fill", "red");

  tooltip.transition().duration(200).style("opacity", .9);
  tooltip.html(`Group : ${d.group}, Value: ${d[selectedVar]}`)
    .style("left", (event.pageX) + "px")
    .style("top", (event.pageY - 28) + "px");
}

function handleMouseOut(event, d) {
  d3.select(this)
    .attr("fill", "#69b3a2");

  tooltip.transition().duration(500).style("opacity", 0);
}

function handleClick(event, d) {
  console.log("Circle clicked:", d);
}


})
        

}
        
        update('var1')
        </script>
</body>
</html>

